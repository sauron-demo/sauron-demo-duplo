# TODO(bbao): Think of better way than to copy paste from yourPeople3.
initial_state: CodeReviewState
merged_state: MergedState

state_machine:
  CodeReviewState:
    status_checks:
      - merge-label:
          label_name: 'SAURON-BOT: Merge It!'
    hotfix: true
    skip-ci: true
    on_success:
      transition_state: IntegrationTestState
    on_failure:
      transition_state: CodeReviewState

  IntegrationTestState:
    status_checks:
      - mordor-glue: null
      - mordor-canary: null
    on_success:
      transition_state: QueuedState
    on_failure:
      transition_state: CodeReviewState
    mordor:
      mordor-glue:
        parallelism: 2
      mordor-canary:
        parallelism: 2

  QueuedState:
    status_checks:
      - merged: null
    on_success:
      transition_state: MergedState
    on_failure:
      transition_state: CodeReviewState

  MergedState:
    status_checks: []
    on_success:
      transition_state: null
    on_failure:
      transition_state: null

hotfix:
  approved_team_names:
    - Infrastructure
    - Hotfix Approvers
  master-hotfix:
    branch_name: master
    label_name: 'HOTFIX: Master Merge'
    on_success:
      transition_state: QueuedState
    on_failure:
      transition_state: CodeReviewState
  production-hotfix:
    branch_name: production
    label_name: 'HOTFIX: Production Merge'
    on_success:
      transition_state: QueuedState
    on_failure:
      transition_state: CodeReviewState

skip-ci:
  min_char_length: 10
  transition_state: QueuedState
